<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>食物管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <link rel="stylesheet" href="../css/index.css" media="all">
</head>

<body>
    <div id="app" class="app">
        <!-- 桌台数据统计块 -->
        <div class="block table-data">
            <div class="head">
                <div class="title">桌台数据</div>
            </div>
            <div class="content" id="table-content" v-if="server_tableStateCount!==null" style="cursor: pointer;"
                @click="manageTable">
                <div class="table-info">
                    <div class="num">{{server_tableStateCount[0]}}</div>
                    <div class="lable">空闲桌数</div>
                </div>
                <div class="gap"></div>
                <div class="table-info">
                    <div class="num">{{server_tableStateCount[1]}}</div>
                    <div class="lable">用餐桌数</div>
                </div>
                <div class="gap"></div>
                <div class="table-info">
                    <div class="num">{{server_tableStateCount[2]}}</div>
                    <div class="lable">全部桌数</div>
                </div>
                <div class="gap"></div>
                <div class="table-info">
                    <div class="num">{{server_tableStateCount[3]}}</div>
                    <div class="lable">开启桌数</div>
                </div>
                <div class="gap"></div>
                <div class="table-info">
                    <div class="num">{{server_tableStateCount[4]}}</div>
                    <div class="lable">停用桌数</div>
                </div>
            </div>
        </div>
        <div class="block table-data">
            <div class="head">
                <div class="title">快捷功能</div>
            </div>
            <div class="content"></div>
        </div>
        <div class="block">
            <div class="classify">
                <div class="position"></div>
                <div class="capacity"></div>
                <div class="state"></div>
            </div>

            <div class="color-tips">
                <div style="width: 25px; height: 25px; background: rgb(0,150,136); border-radius: 15%; margin: 10px;">
                </div>空闲
                <div style="width: 25px; height: 25px; background: rgb(255,184,0); border-radius: 15%; margin: 10px;">
                </div>用餐中
                <div style="width: 25px; height: 25px; background: rgb(169,169,169); border-radius: 15%; margin: 10px;">
                </div>未启用
            </div>
            <div class="tables">
                <span v-for="(table, index) in server_table" v-if="server_table!=null">
                    <div :class="'my-table '+ (table.state===0?'free':(table.state===1?'busy':'disable'))"
                        @click="clickTable(index)">
                        <img src='../images/table.png' draggable="false">
                        <div class="table-id">{{table.id}}</div>
                        <div class="table-seats">{{table.seats}} 人座</div>
                    </div>
                </span>
            </div>
        </div>
    </div>

    <script src="../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>
    <script>
        layui.use(['form', 'table'], function () {
            var $ = layui.jquery,
                form = layui.form,
                table = layui.table;
            var app = new Vue({
                el: "#app",
                data: {
                    server_table: null,
                    server_tableStateCount: null
                },
                mounted: function () {
                    this.init();
                },
                methods: {
                    init: function () {
                        let vm = this;
                        this.$http.get('http://linqiu.ltd/table/all').then(
                            (response) => {
                                vm.$set(this, "server_table", response.body.data);
                            },
                            (response) => {
                                layer.msg("初始化失败！", { icon: 2 });
                            }
                        );
                        this.$http.get('http://linqiu.ltd/table/stateCount').then(
                            (response) => {
                                vm.$set(this, "server_tableStateCount", response.body.data);
                            },
                            (response) => {
                                layer.msg("初始化失败！", { icon: 2 });
                            }
                        );
                    },
                    clickTable: function (index) {
                        let table = this.server_table[index];
                        layer.msg(JSON.stringify(table))
                    },
                    manageTable: function () {
                        layer.open({
                            title: '餐桌管理',
                            type: 2,
                            shade: 0.2,
                            maxmin: true,
                            shadeClose: true,
                            area: ['100%', '100%'],
                            content: '../page/table.html'
                        });
                    }
                }
            })
        })
    </script>

</body>

</html>